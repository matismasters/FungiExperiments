---
const {firstPhoto} = Astro.props

---

<div class="form-container">
    <label for="input-image" class="label-upload-image">Sacar foto</label>

    <img class="show-img" />


    <!--We only allow adding the substratums if we are taking the first photo-->
    {firstPhoto && 
        <div class="substratum-section">
        </div>

       <button class="button-add-substratum">Nuevo Sustrato</button>
    }
    <input class="input-image" id="input-image" type="file"  accept="image" capture style="visibility: hidden;">
</div>



<script>
    const container = document.querySelector(".form-container")
    const showImage = document.querySelector(".show-img")
    const input = (document.querySelector(".input-image") as HTMLInputElement)
    const buttonAddSubstratum = document.querySelector(".button-add-substratum")

    
    input.addEventListener("change",handleImage)
    buttonAddSubstratum.addEventListener("click",addSubstratumSelectionToDom)

    function handleImage(){
        const currentFile = input.files[input.files.length-1]
        loadImageToBackground(currentFile,showImage)
        const reader = new FileReader()
        const blobImage = new Blob([currentFile])
        reader.onloadend = ()=>{
            console.log(reader.result)
        }
        reader.readAsArrayBuffer(blobImage)
    }

    function loadImageToBackground(currentFile,imgElement){
        const src = URL.createObjectURL(currentFile)
        imgElement.src = src
    }
    //adds the html element to insert the substratum quantity
    function addSubstratumSelectionToDom(){
        //main div that will be added to the dom, its a row that contains a column and a delete button
        const main = document.createElement("div")
        main.className = "substratum-container-row"

        //main column
        const mainCol = document.createElement("div")
        mainCol.className = "substratum-container-col"

        //name of the substratum, this will later be a select instead of input text
        const select = document.createElement("select")
        const options = createOptionsForSelect()
        options.forEach(o=>{
            select.appendChild(o)
        })
        mainCol.appendChild(select)

        //percentage of that substratum
        const inputNumber = document.createElement("input")
        inputNumber.className="substratum-number"
        inputNumber.type = "number"
        inputNumber.placeholder ="Porcentaje"
        mainCol.appendChild(inputNumber)

        //add the whole column to the main div
        main.appendChild(mainCol)

        //button to remove the element
        const removeButton = document.createElement("button")
        removeButton.className = "button-remove-substratum"
        removeButton.textContent="X"
        removeButton.addEventListener("click",()=>main.remove())
        main.appendChild(removeButton)
        //append it to the dom
        document.querySelector(".substratum-section").appendChild(main)
    }
    //placeholder
    function createOptionsForSelect(){
        const listOfOptions = []

        for(let i=0;i<10;i++){
            const option = document.createElement("option")
            option.value=`sustrato ${i}`
            option.textContent=`sustrato ${i}`
            listOfOptions.push(option)
        }
        return listOfOptions
    }

</script>

<style is:inline> 
    .button-add-substratum{
        background-color: wheat;
        color: rgb(0, 0, 0);
        border-radius: 10px;
        cursor: pointer;
        font-size: large;
        padding: 30px;
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .label-upload-image{
        color: black;
        cursor: pointer;
        padding: 20px;
        background-color: wheat;
        border-radius: 10px;
        font-size: xx-large;
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .form-container{
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 20px;
    }
    img{
        max-width: 50%;
    }

    .substratum-section{
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }
    .substratum-container-row{
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        gap: 10px;
       
    }
    .button-remove-substratum{
        font-size: xx-large;
        background-color: wheat;
        color: rgb(233, 69, 69);
        border-width: 0px;
        cursor: pointer;
    }
    .substratum-container-col{
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    
        width: 100%;
    }
    .substratum-container-col input{
        width: 200px;
        padding: 0px;
        box-sizing: border-box;
        font-size: x-large;
    }.substratum-container-col select{
        width: 200px;
        font-size: x-large;
    }

</style>